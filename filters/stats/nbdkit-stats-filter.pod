=head1 NAME

nbdkit-stats-filter - display statistics about operations

=head1 SYNOPSIS

 nbdkit --filter=stats PLUGIN statsfile=FILE
                       [statsappend=true] [statsthreshold=PERCENTILE]

=head1 DESCRIPTION

C<nbdkit-stats-filter> is a filter that displays statistics about NBD
operations, such as the number of bytes read and written.  Statistics
are written to a file once when nbdkit exits.

=head1 EXAMPLE OUTPUT

 # nbdkit --filter=exitfirst --filter=stats memory 25G statsfile=example.txt
 # nbd-client localhost /dev/nbd1 && mkfs.ext4 /dev/nbd1 &&
   nbd-client -d /dev/nbd1
 [....]
 # cat example.txt
 total: 1252 ops, 3.395897 s, 25.13 GiB, 7.40 GiB/s
 read: 145 ops, 0.000133 s, 3.04 MiB, 22.34 GiB/s op, 917.58 KiB/s total
 write: 1088 ops, 0.065065 s, 132.38 MiB, 1.99 GiB/s op, 38.98 MiB/s total
 trim: 14 ops, 0.002037 s, 25.00 GiB, 12272.95 GiB/s op, 7.36 GiB/s total
 flush: 5 ops, 0.000002 s, 0 bytes, 0 bytes/s op, 0 bytes/s total
 
 READ request sizes:
      4096 bytes: 66.2% of requests (96)
          12 bit aligned: 100.0% (96)
          13 bit aligned:  69.8% (67)
          14 bit aligned:  54.2% (52)
          15 bit aligned:  46.9% (45)
          16 bit aligned:  41.7% (40)
          17 bit aligned:  36.5% (35)
          18 bit aligned:  31.2% (30)
          19+ bit-aligned: 28.1% (27)
     16384 bytes:  4.8% of requests (7)
          13 bit aligned: 100.0% (7)
          17 bit aligned:  71.4% (5)
          19 bit aligned:  42.9% (3)
     other sizes: 29.0% of requests (42)
 
 WRITE request sizes:
    131072 bytes: 97.1% of requests (1056)
          17 bit aligned: 100.0% (1056)
          18 bit aligned:  50.0% (528)
          19+ bit-aligned: 25.0% (264)
     other sizes:  2.9% of requests (32)
 
 TRIM request sizes:
 2147483648 bytes: 85.7% of requests (12)
          24 bit aligned: 100.0% (12)
     other sizes: 14.3% of requests (2)
 
 ZERO request sizes:
     (no such requests)

=head1 PARAMETERS

=over 4

=item B<statsfile=>FILE

The file where we write the stats.

This parameter is required.

=item B<statsappend=true>

If set then we append to the file instead of replacing it.

=item B<statsthreshold=>PERCENTILE

Percentile of requests for which block size histogram should be printed.
Set to zero to disable collection of block size statistics. Set to 100
to get a list of every block size encountered. Default: 95.

=back

=head1 FILES

=over 4

=item F<$filterdir/nbdkit-stats-filter.so>

The filter.

Use C<nbdkit --dump-config> to find the location of C<$filterdir>.

=back

=head1 VERSION

C<nbdkit-stats-filter> first appeared in nbdkit 1.14.

=head1 SEE ALSO

L<nbdkit(1)>,
L<nbdkit-filter(3)>,
L<nbdkit-log-filter(1)>.

=head1 AUTHORS

Richard W.M. Jones

Nikolaus Rath

=head1 COPYRIGHT

Copyright (C) 2019-2022 Red Hat Inc.
